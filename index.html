<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TEN Dashboard - 32 Cards</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { transition: all 0.2s; }
    .card:hover { transform: translateY(-2px); border-color: #dc2626; }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: #1e293b; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #475569; border-radius: 3px; }
  </style>
</head>
<body class="bg-slate-950 text-white">
  
  <!-- Header -->
  <header class="bg-gradient-to-r from-red-700 to-red-600 shadow-xl sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-4">
          <div class="text-3xl font-black">TEN<span class="text-red-300">:</span></div>
          <div class="text-sm text-red-100/80">The Essential Newsroom</div>
          <div id="mode-badge" class="text-[10px] px-2 py-1 rounded bg-black/20 text-red-100/80 border border-white/20 hidden"></div>
        </div>
        <div class="bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg">
          <div class="text-xs text-red-100/70" id="stock-symbol">TTE.PA</div>
          <div class="text-xl font-bold" id="stock-price-line">-- <span class="text-sm text-red-300">--</span></div>
          <div class="text-[10px] text-red-100/70 mt-1" id="stock-update">Mise a jour: --</div>
        </div>
      </div>
    </div>
  </header>

  <!-- Navigation -->
  <nav class="bg-slate-900 border-b border-slate-800 sticky top-[72px] z-30">
    <div class="max-w-7xl mx-auto px-6">
      <div class="flex gap-1 overflow-x-auto">
        <button onclick="showSection('mentions', event)" class="nav-btn px-4 py-3 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800">
          01 MENTIONS (2)
        </button>
        <button onclick="showSection('brief', event)" class="nav-btn px-4 py-3 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800">
          02 BRIEF (4)
        </button>
        <button onclick="showSection('une', event)" class="nav-btn px-4 py-3 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800">
          03 Ã€ LA UNE (1)
        </button>
        <button onclick="showSection('signals', event)" class="nav-btn px-4 py-3 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800">
          04 SIGNALS (2)
        </button>
        <button onclick="showSection('intelligence', event)" class="nav-btn px-4 py-3 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800">
          05 INTELLIGENCE (13)
        </button>
        <button onclick="showSection('outils', event)" class="nav-btn px-4 py-3 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800">
          06 OUTILS (7)
        </button>
        <button onclick="showSection('atp', event)" class="nav-btn px-4 py-3 text-xs font-medium text-slate-400 hover:text-white hover:bg-slate-800">
          07 OUTILS ATP (3)
        </button>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-6 py-8">

    <!-- 01 MENTIONS -->
    <div id="section-mentions" class="section">
      <h2 class="text-2xl font-bold mb-6">01 MENTIONS</h2>
      <div class="grid gap-4 md:grid-cols-2">
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“¡</div>
          <h3 class="text-lg font-bold mb-2">Live Stream</h3>
          <p class="text-slate-400 text-sm mb-3">Flux temps rÃ©el des mentions TotalEnergies</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Dashboard live</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ”¥</div>
          <h3 class="text-lg font-bold mb-2">5 Sujets Chauds</h3>
          <p class="text-slate-400 text-sm mb-3">Les 5 sujets prioritaires du jour avec contexte</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Liste priorisÃ©e</span>
        </div>
      </div>
      <div id="live-stream-container" class="mt-6"></div>
    </div>

    <!-- 02 BRIEF -->
    <div id="section-brief" class="section hidden">
      <h2 class="text-2xl font-bold mb-6">02 BRIEF</h2>
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ’¬</div>
          <h3 class="text-lg font-bold mb-2">Brief WhatsApp CEO/ComEx</h3>
          <p class="text-slate-400 text-sm mb-3">SynthÃ¨se quali avec citations Ã©ditorialistes, emojis, format mobile</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Message WhatsApp ready</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸŒ</div>
          <h3 class="text-lg font-bold mb-2">3 Lectures GÃ©opolitiques</h3>
          <p class="text-slate-400 text-sm mb-3">DÃ©cryptage des enjeux gÃ©opolitiques impactant TTE</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">3 analyses contextuelles</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“ˆ</div>
          <h3 class="text-lg font-bold mb-2">3 Signaux Macro</h3>
          <p class="text-slate-400 text-sm mb-3">Tendances Ã©conomiques et sectorielles Ã  surveiller</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">3 signaux commentÃ©s</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“°</div>
          <h3 class="text-lg font-bold mb-2">Opinion du Jour</h3>
          <p class="text-slate-400 text-sm mb-3">L'Ã©ditorial ou tribune la plus significative</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">1 opinion analysÃ©e</span>
        </div>
      </div>
      <div id="hot-topics-container" class="mt-6"></div>
    </div>

    <!-- 03 Ã€ LA UNE -->
    <div id="section-une" class="section hidden">
      <h2 class="text-2xl font-bold mb-6">03 Ã€ LA UNE</h2>
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“¸</div>
          <h3 class="text-lg font-bold mb-2">Top Couvertures</h3>
          <p class="text-slate-400 text-sm mb-3">Les 4 Unes les plus impactantes du jour</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">4 visuels + analyse</span>
        </div>
      </div>
    </div>

    <!-- 04 SIGNALS -->
    <div id="section-signals" class="section hidden">
      <h2 class="text-2xl font-bold mb-6">04 SIGNALS</h2>
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“¡</div>
          <h3 class="text-lg font-bold mb-2">8 Weak Signals</h3>
          <p class="text-slate-400 text-sm mb-3">Signaux faibles Ã  surveiller (mÃ©dias, ONG, politique)</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">8 alertes qualifiÃ©es</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">âš–ï¸</div>
          <h3 class="text-lg font-bold mb-2">Benchmark MarchÃ©s</h3>
          <p class="text-slate-400 text-sm mb-3">Positionnement mÃ©diatique vs concurrents (Shell, BP, Equinor)</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Tableau comparatif</span>
        </div>
      </div>
    </div>

    <!-- 05 INTELLIGENCE -->
    <div id="section-intelligence" class="section hidden">
      <h2 class="text-2xl font-bold mb-6">05 INTELLIGENCE</h2>
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ”®</div>
          <h3 class="text-lg font-bold mb-2">PrÃ©diction 48h</h3>
          <p class="text-slate-400 text-sm mb-3">Anticipation des sujets Ã©mergents Ã  48h</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">3 scÃ©narios probabilisÃ©s</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸš¨</div>
          <h3 class="text-lg font-bold mb-2">Alerte Crise</h3>
          <p class="text-slate-400 text-sm mb-3">DÃ©tection automatique des signaux de crise</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Alerte push + brief</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ’¬</div>
          <h3 class="text-lg font-bold mb-2">Q&A TotalEnergies</h3>
          <p class="text-slate-400 text-sm mb-3">Base de questions-rÃ©ponses actualisÃ©e par sujet</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Fiches Q&A</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">âš–ï¸</div>
          <h3 class="text-lg font-bold mb-2">Matrice Risque/OpportunitÃ©</h3>
          <p class="text-slate-400 text-sm mb-3">Cartographie des risques et opportunitÃ©s par sujet</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Matrice visuelle</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“±</div>
          <h3 class="text-lg font-bold mb-2">Ã‰cho Social</h3>
          <p class="text-slate-400 text-sm mb-3">Analyse des conversations social media sur TTE</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Dashboard social</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ¯</div>
          <h3 class="text-lg font-bold mb-2">DÃ©cryptage Narratif Adverse ONG</h3>
          <p class="text-slate-400 text-sm mb-3">Analyse campagnes ONG : Ã©lÃ©ments langage, contre-arguments, calendrier</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Rapport mensuel</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“„</div>
          <h3 class="text-lg font-bold mb-2">Brief ExÃ©cutif One-Pager</h3>
          <p class="text-slate-400 text-sm mb-3">SynthÃ¨se ultra-condensÃ©e 1 page A4 pour prÃ©pa mÃ©dia dirigeant</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">PDF 1 page</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“</div>
          <h3 class="text-lg font-bold mb-2">Ã‰tat de l'Opinion Ã‰lite</h3>
          <p class="text-slate-400 text-sm mb-3">Mesure de l'Ã©tat d'esprit des prescripteurs (Ã©ditos, tribunes, think tanks)</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">PDF dicible/risque</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">â°</div>
          <h3 class="text-lg font-bold mb-2">FenÃªtres de Parole & Silence</h3>
          <p class="text-slate-400 text-sm mb-3">Identification des moments pour parler, se taire, laisser faire</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Recommandations timing</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ›ï¸</div>
          <h3 class="text-lg font-bold mb-2">Lecture Politique AnticipÃ©e</h3>
          <p class="text-slate-400 text-sm mb-3">Anticipation du passage mÃ©diatique â†’ politique â†’ rÃ©glementaire</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Risque politisation</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“Š</div>
          <h3 class="text-lg font-bold mb-2">BaromÃ¨tre CrÃ©dibilitÃ© Corporate</h3>
          <p class="text-slate-400 text-sm mb-3">Mesure de la crÃ©dibilitÃ© TTE par thÃ¨me (transition, Afrique, innovation...)</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Tableau ğŸŸ¢ğŸŸ ğŸ”´</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ’</div>
          <h3 class="text-lg font-bold mb-2">Narratifs Favorables Dormants</h3>
          <p class="text-slate-400 text-sm mb-3">Identification des rÃ©cits positifs non exploitÃ©s, alliÃ©s silencieux</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">OpportunitÃ©s narratives</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“‰</div>
          <h3 class="text-lg font-bold mb-2">Indice Saturation MÃ©diatique</h3>
          <p class="text-slate-400 text-sm mb-3">Mesure de la fatigue mÃ©diatique sur un sujet (Ã©viter sur-rÃ©action)</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Indicateur saturation</span>
        </div>
      </div>
    </div>

    <!-- 06 OUTILS -->
    <div id="section-outils" class="section hidden">
      <h2 class="text-2xl font-bold mb-6">06 OUTILS</h2>
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“¥</div>
          <h3 class="text-lg font-bold mb-2">Export PDF Brief Complet</h3>
          <p class="text-slate-400 text-sm mb-3">Export PDF formatÃ© du brief quotidien complet</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">PDF branded TEN</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ”</div>
          <h3 class="text-lg font-bold mb-2">Historique & Recherche</h3>
          <p class="text-slate-400 text-sm mb-3">AccÃ¨s Ã  l'historique des briefs et recherche par sujet/date</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Interface recherche</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ™ï¸</div>
          <h3 class="text-lg font-bold mb-2">Energy News Briefing</h3>
          <p class="text-slate-400 text-sm mb-3">Brief audio-ready pour diffusion interne (format podcast)</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Script audio 3min</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“§</div>
          <h3 class="text-lg font-bold mb-2">Mail Comex</h3>
          <p class="text-slate-400 text-sm mb-3">Email formatÃ© prÃªt Ã  envoyer au Comex</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Email ready-to-send</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸŒ</div>
          <h3 class="text-lg font-bold mb-2">Veille GÃ©opolitique Dossier</h3>
          <p class="text-slate-400 text-sm mb-3">Dossier thÃ©matique approfondi sur zone gÃ©ographique</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">PDF 5-10 pages</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ’¬</div>
          <h3 class="text-lg font-bold mb-2">Partage WhatsApp</h3>
          <p class="text-slate-400 text-sm mb-3">Message WhatsApp formatÃ© avec emojis pour partage rapide</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Message WhatsApp</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“Š</div>
          <h3 class="text-lg font-bold mb-2">RetombÃ©es CP</h3>
          <p class="text-slate-400 text-sm mb-3">Analyse des retombÃ©es post-communiquÃ© de presse</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Rapport retombÃ©es</span>
        </div>
      </div>
    </div>

    <!-- 07 OUTILS ATP -->
    <div id="section-atp" class="section hidden">
      <h2 class="text-2xl font-bold mb-6">07 OUTILS ATP</h2>
      <div class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ‘¤</div>
          <h3 class="text-lg font-bold mb-2">Fiche Journaliste PrÃ©paratoire</h3>
          <p class="text-slate-400 text-sm mb-3">Bio + articles rÃ©cents + positionnement TTE + conseils pitch avant RDV</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">PDF 1-2 pages</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“§</div>
          <h3 class="text-lg font-bold mb-2">Email RÃ©cap + Note Intelligence</h3>
          <p class="text-slate-400 text-sm mb-3">Email ready-to-send + note PDF aprÃ¨s sÃ©quence mÃ©diatique</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">Email + PDF 2-3 pages</span>
        </div>
        <div class="card bg-slate-900 rounded-lg p-6 border border-slate-800 cursor-pointer">
          <div class="text-4xl mb-3">ğŸ“š</div>
          <h3 class="text-lg font-bold mb-2">Dossier ThÃ©matique Sur Demande</h3>
          <p class="text-slate-400 text-sm mb-3">Dossier complet sur un sujet (GNL, hydrogÃ¨ne...) : articles, journalistes, angles</p>
          <span class="text-xs px-2 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">PDF 5-10 pages</span>
        </div>
      </div>
    </div>

  </main>

  <script>
    const REFRESH_MS = 15000;
    const STANDALONE_MODE = window.location.protocol === 'file:';
    const STANDALONE_FALLBACK_NEWS = [
      { title: "TotalEnergies relance le projet Mozambique LNG", summary: "Reprise officielle du projet gazier avec perspectives de production 2029 et forte exposition mÃ©diatique internationale.", publishedAt: "2026-02-07T08:10:00Z", source: "Reuters", feedTitle: "Reuters Business", country: "ğŸŒ", link: "https://www.reuters.com/" },
      { title: "Oiseaux mazoutÃ©s en Bretagne: retour du dossier Erika", summary: "Des associations environnementales relancent le dÃ©bat sur les responsabilitÃ©s historiques et la rÃ©paration des dommages.", publishedAt: "2026-02-07T07:25:00Z", source: "France Info", feedTitle: "Google News - TotalEnergies", country: "ğŸ”", link: "https://news.google.com/" },
      { title: "MarchÃ©s pÃ©troliers: le Brent reste sous tension", summary: "Les tensions gÃ©opolitiques au Moyen-Orient alimentent la volatilitÃ© des prix de l'Ã©nergie.", publishedAt: "2026-02-07T06:40:00Z", source: "MarketWatch", feedTitle: "MarketWatch", country: "ğŸ‡ºğŸ‡¸", link: "https://www.marketwatch.com/" },
      { title: "NAO: dÃ©bat sur les salaires dans les grands groupes Ã©nergÃ©tiques", summary: "Les syndicats appellent Ã  renforcer le dialogue social aprÃ¨s des nÃ©gociations jugÃ©es insuffisantes.", publishedAt: "2026-02-07T06:00:00Z", source: "BBC", feedTitle: "BBC News Business", country: "ğŸ‡¬ğŸ‡§", link: "https://www.bbc.com/news/business" },
      { title: "Transition Ã©nergÃ©tique: accÃ©lÃ©ration des contrats d'Ã©lectricitÃ© renouvelable", summary: "Plusieurs industriels signent des accords long terme pour sÃ©curiser leur approvisionnement bas carbone.", publishedAt: "2026-02-07T05:30:00Z", source: "The Guardian", feedTitle: "The Guardian Business", country: "ğŸ‡¬ğŸ‡§", link: "https://www.theguardian.com/uk/business" },
      { title: "LNG mondial: nouvelle vague d'investissements en Afrique", summary: "Le GNL reste un axe stratÃ©gique pour la sÃ©curitÃ© Ã©nergÃ©tique de plusieurs rÃ©gions.", publishedAt: "2026-02-07T04:50:00Z", source: "Al Jazeera", feedTitle: "Al Jazeera", country: "ğŸŒ", link: "https://www.aljazeera.com/" },
      { title: "Les majors pÃ©troliÃ¨res sous pression des ONG climat", summary: "Des campagnes coordonnÃ©es ciblent les communications d'entreprise et les engagements de neutralitÃ© carbone.", publishedAt: "2026-02-07T04:05:00Z", source: "Euronews", feedTitle: "Euronews", country: "ğŸ‡ªğŸ‡º", link: "https://www.euronews.com/" },
      { title: "HydrogÃ¨ne et e-fuels: montÃ©e des partenariats industriels", summary: "Les projets pilotes se multiplient pour dÃ©carboner les usages lourds.", publishedAt: "2026-02-07T03:45:00Z", source: "Investing.com", feedTitle: "Investing.com", country: "ğŸŒ", link: "https://www.investing.com/" },
      { title: "Offshore: capex en hausse sur plusieurs bassins", summary: "Les dÃ©penses d'exploration-production repartent dans certaines zones clÃ©s.", publishedAt: "2026-02-07T03:10:00Z", source: "Offshore Energy", feedTitle: "Offshore Energy", country: "ğŸ›¢ï¸", link: "https://www.offshore-energy.biz/" },
      { title: "Les importations LNG europÃ©ennes restent soutenues", summary: "L'Europe continue de diversifier ses approvisionnements gaziers.", publishedAt: "2026-02-07T02:35:00Z", source: "Energy Voice", feedTitle: "Energy Voice", country: "ğŸ›¢ï¸", link: "https://www.energyvoice.com/" },
      { title: "Shell et BP: stratÃ©gies divergentes face aux investisseurs", summary: "Les analystes comparent les trajectoires de rentabilitÃ© et de transition des majors.", publishedAt: "2026-02-07T01:55:00Z", source: "Yahoo Finance", feedTitle: "Yahoo Finance", country: "ğŸ‡ºğŸ‡¸", link: "https://finance.yahoo.com/" },
      { title: "Prix du brut: impact des dÃ©cisions OPEC+ attendu", summary: "Les traders anticipent les prochaines annonces de quotas et leur effet sur les marges.", publishedAt: "2026-02-07T01:15:00Z", source: "CNBC", feedTitle: "CNBC Top News", country: "ğŸ‡ºğŸ‡¸", link: "https://www.cnbc.com/" },
      { title: "Politique Ã©nergÃ©tique US: cap sur la production domestique", summary: "Washington maintient une ligne favorable Ã  la sÃ©curitÃ© Ã©nergÃ©tique nationale.", publishedAt: "2026-02-07T00:50:00Z", source: "Reuters", feedTitle: "Reuters Business", country: "ğŸŒ", link: "https://www.reuters.com/" },
      { title: "Liban offshore: consortiums et risques gÃ©opolitiques", summary: "Les analystes soulignent la complexitÃ© opÃ©rationnelle en MÃ©diterranÃ©e orientale.", publishedAt: "2026-02-07T00:20:00Z", source: "World Oil", feedTitle: "World Oil", country: "ğŸ›¢ï¸", link: "https://www.worldoil.com/" },
      { title: "Risque rÃ©putationnel: la bataille des narratifs continue", summary: "La perception publique reste un facteur majeur de valorisation dans l'Ã©nergie.", publishedAt: "2026-02-06T23:45:00Z", source: "Google News", feedTitle: "Google News - Energy", country: "ğŸ”", link: "https://news.google.com/" },
      { title: "Projet solaire industriel: nouveaux PPA annoncÃ©s", summary: "Les contrats de long terme soutiennent la visibilitÃ© financiÃ¨re des producteurs.", publishedAt: "2026-02-06T22:55:00Z", source: "The Guardian", feedTitle: "The Guardian Business", country: "ğŸ‡¬ğŸ‡§", link: "https://www.theguardian.com/uk/business" },
      { title: "Gaz naturel liquÃ©fiÃ©: concurrence accrue Asie/Europe", summary: "Les arbitrages de cargaisons intensifient la compÃ©tition entre rÃ©gions importatrices.", publishedAt: "2026-02-06T21:40:00Z", source: "Al Jazeera", feedTitle: "Google News - LNG", country: "ğŸ”", link: "https://news.google.com/" },
      { title: "TotalEnergies: focus investisseurs sur la discipline financiÃ¨re", summary: "Le marchÃ© surveille la gÃ©nÃ©ration de cash-flow et les retours actionnaires.", publishedAt: "2026-02-06T20:55:00Z", source: "MarketWatch", feedTitle: "MarketWatch", country: "ğŸ‡ºğŸ‡¸", link: "https://www.marketwatch.com/" },
      { title: "Campagnes climat: intensification des actions terrain", summary: "Des collectifs annoncent de nouvelles mobilisations au premier trimestre.", publishedAt: "2026-02-06T20:20:00Z", source: "Euronews", feedTitle: "Euronews", country: "ğŸ‡ªğŸ‡º", link: "https://www.euronews.com/" },
      { title: "Raffinage: marges contrastÃ©es selon les rÃ©gions", summary: "Les performances divergent entre Europe, Asie et AmÃ©rique du Nord.", publishedAt: "2026-02-06T19:35:00Z", source: "OilPrice", feedTitle: "OilPrice.com", country: "ğŸ›¢ï¸", link: "https://oilprice.com/" }
    ];
    const STANDALONE_SOURCES = [
      { name: "Reuters Business", url: "https://feeds.reuters.com/reuters/businessNews", country: "ğŸŒ" },
      { name: "BBC News Business", url: "http://feeds.bbci.co.uk/news/business/rss.xml", country: "ğŸ‡¬ğŸ‡§" },
      { name: "The Guardian Business", url: "https://www.theguardian.com/uk/business/rss", country: "ğŸ‡¬ğŸ‡§" },
      { name: "Al Jazeera", url: "https://www.aljazeera.com/xml/rss/all.xml", country: "ğŸŒ" },
      { name: "Yahoo Finance", url: "https://finance.yahoo.com/news/rssindex", country: "ğŸ‡ºğŸ‡¸" },
      { name: "CNBC Top News", url: "https://www.cnbc.com/id/100003114/device/rss/rss.html", country: "ğŸ‡ºğŸ‡¸" },
      { name: "MarketWatch", url: "http://feeds.marketwatch.com/marketwatch/topstories/", country: "ğŸ‡ºğŸ‡¸" },
      { name: "Investing.com", url: "https://www.investing.com/rss/news.rss", country: "ğŸŒ" },
      { name: "OilPrice.com", url: "https://oilprice.com/rss/main", country: "ğŸ›¢ï¸" },
      { name: "Energy Voice", url: "https://www.energyvoice.com/feed/", country: "ğŸ›¢ï¸" },
      { name: "World Oil", url: "https://www.worldoil.com/feed", country: "ğŸ›¢ï¸" },
      { name: "Offshore Energy", url: "https://www.offshore-energy.biz/feed/", country: "ğŸ›¢ï¸" },
      { name: "Rigzone", url: "http://www.rigzone.com/rss/news.aspx", country: "ğŸ›¢ï¸" },
      { name: "Google News - TotalEnergies", url: "https://news.google.com/rss/search?q=TotalEnergies&hl=en&gl=US&ceid=US:en", country: "ğŸ”" },
      { name: "Google News - Energy", url: "https://news.google.com/rss/search?q=energy+oil+gas&hl=en&gl=US&ceid=US:en", country: "ğŸ”" },
      { name: "Google News - LNG", url: "https://news.google.com/rss/search?q=LNG+liquefied+natural+gas&hl=en&gl=US&ceid=US:en", country: "ğŸ”" },
      { name: "Google News - Renewable", url: "https://news.google.com/rss/search?q=renewable+energy+solar+wind&hl=en&gl=US&ceid=US:en", country: "ğŸ”" },
      { name: "Euronews", url: "https://www.euronews.com/rss?level=theme&name=news", country: "ğŸ‡ªğŸ‡º" },
    ];

    let newsData = [];
    let sourcesUsed = [];
    let stockData = null;
    let isLoading = false;

    function showSection(sectionId, evt) {
      document.querySelectorAll('.section').forEach((s) => s.classList.add('hidden'));
      document.getElementById('section-' + sectionId).classList.remove('hidden');
      document.querySelectorAll('.nav-btn').forEach((btn) => {
        btn.classList.remove('bg-red-600', 'text-white');
        btn.classList.add('text-slate-400');
      });
      const trigger = evt?.currentTarget || evt?.target;
      if (trigger) {
        trigger.classList.add('bg-red-600', 'text-white');
        trigger.classList.remove('text-slate-400');
      }
      window.scrollTo(0, 0);
    }

    function escapeHtml(value = '') {
      return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function formatTime(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      if (Number.isNaN(date.getTime())) return '';
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);
      if (diff < 60) return "A l'instant";
      if (diff < 3600) return `il y a ${Math.floor(diff / 60)}min`;
      if (diff < 86400) return `il y a ${Math.floor(diff / 3600)}h`;
      return date.toLocaleDateString('fr-FR');
    }

    function parseFeedXml(xmlText, sourceMeta) {
      const doc = new DOMParser().parseFromString(xmlText, 'text/xml');
      const parseItem = (node, atom = false) => {
        const get = (sel) => node.querySelector(sel)?.textContent?.trim() || '';
        const title = get('title');
        const summary = get('description') || get('summary') || get('content');
        const publishedAt = get('pubDate') || get('published') || get('updated');
        let link = '';
        if (atom) {
          link = node.querySelector('link[rel="alternate"]')?.getAttribute('href')
            || node.querySelector('link')?.getAttribute('href')
            || '';
        } else {
          link = get('link');
        }
        return {
          id: link || title,
          title,
          link,
          summary: summary.replace(/<[^>]*>/g, ' ').replace(/\s+/g, ' ').trim(),
          publishedAt,
          source: sourceMeta.name,
          feedTitle: sourceMeta.name,
          country: sourceMeta.country || 'ğŸŒ',
        };
      };

      const rssItems = Array.from(doc.querySelectorAll('rss channel item')).map((n) => parseItem(n, false));
      if (rssItems.length) return rssItems;
      return Array.from(doc.querySelectorAll('feed entry')).map((n) => parseItem(n, true));
    }

    async function loadStandaloneNews() {
      const fetchOne = async (src) => {
        const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent(src.url)}`;
        const res = await fetch(proxy, { cache: 'no-store' });
        if (!res.ok) return [];
        const xml = await res.text();
        return parseFeedXml(xml, src);
      };
      const results = await Promise.allSettled(STANDALONE_SOURCES.map(fetchOne));
      const merged = [];
      results.forEach((r) => {
        if (r.status === 'fulfilled' && Array.isArray(r.value)) merged.push(...r.value);
      });
      const dedup = new Map();
      merged.forEach((item) => {
        const key = item.link || item.title;
        if (!key || dedup.has(key)) return;
        dedup.set(key, item);
      });
      const items = Array.from(dedup.values())
        .sort((a, b) => new Date(b.publishedAt || 0) - new Date(a.publishedAt || 0))
        .slice(0, 60);
      if (items.length >= 8) {
        return {
          updatedAt: new Date().toISOString(),
          sources: STANDALONE_SOURCES.map((s) => s.name),
          items,
        };
      }
      return {
        updatedAt: new Date().toISOString(),
        sources: [...STANDALONE_SOURCES.map((s) => s.name), "Snapshot local"],
        items: STANDALONE_FALLBACK_NEWS,
      };
    }

    async function loadStandaloneStock() {
      try {
        const proxy = `https://api.allorigins.win/raw?url=${encodeURIComponent('https://query1.finance.yahoo.com/v8/finance/chart/TTE.PA?interval=1d&range=5d')}`;
        const res = await fetch(proxy, { cache: 'no-store' });
        if (!res.ok) throw new Error('Stock proxy error');
        const data = await res.json();
        const result = data.chart?.result?.[0];
        const meta = result?.meta || {};
        const currentPrice = Number(meta.regularMarketPrice || 0);
        const previousClose = Number(meta.previousClose || meta.chartPreviousClose || 0);
        const change = currentPrice - previousClose;
        const changePercent = previousClose ? (change / previousClose) * 100 : 0;
        return {
          symbol: 'TTE.PA',
          price: currentPrice.toFixed(2),
          changePercent: changePercent.toFixed(2),
          currency: meta.currency || 'EUR',
          lastUpdate: new Date().toISOString(),
        };
      } catch {
        return {
          symbol: 'TTE.PA',
          price: '60.14',
          changePercent: '-1.65',
          currency: 'EUR',
          fallback: true,
          lastUpdate: new Date().toISOString(),
        };
      }
    }

    function updateStockWidget() {
      if (!stockData) return;
      const priceLine = document.getElementById('stock-price-line');
      const symbol = document.getElementById('stock-symbol');
      const update = document.getElementById('stock-update');
      const change = Number(stockData.changePercent || 0);
      const color = change >= 0 ? 'text-emerald-300' : 'text-red-300';
      const sign = change >= 0 ? '+' : '';
      symbol.textContent = stockData.symbol || 'TTE.PA';
      priceLine.innerHTML = `${escapeHtml(stockData.price)}${stockData.currency === 'EUR' ? 'â‚¬' : ''} <span class="text-sm ${color}">${sign}${escapeHtml(stockData.changePercent)}%</span>`;
      update.textContent = `Mise a jour: ${formatTime(stockData.lastUpdate) || '--'}`;
    }

    function populateMentions(updatedAt) {
      const container = document.getElementById('live-stream-container');
      if (!container) return;
      const latest = newsData.slice(0, 20);
      const sourceBadges = sourcesUsed.slice(0, 12).map((name) =>
        `<span class="text-[10px] px-2 py-1 rounded bg-slate-800 border border-slate-700 text-slate-300">${escapeHtml(name)}</span>`
      ).join('');

      container.innerHTML = `
        <div class="bg-slate-900 rounded-lg p-6 border border-slate-800">
          <div class="flex items-center justify-between mb-3 gap-4 flex-wrap">
            <h3 class="text-xl font-bold">ğŸ“¡ Live Stream</h3>
            <div class="flex items-center gap-3 text-emerald-400 text-sm">
              <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-emerald-400 rounded-full animate-pulse"></div>
                <span>${newsData.length} articles</span>
              </div>
              <span class="text-slate-500">â€¢</span>
              <span class="text-slate-400">MAJ ${formatTime(updatedAt)}</span>
            </div>
          </div>
          <p class="text-xs text-slate-400 mb-3">Sources actives (${sourcesUsed.length})</p>
          <div class="flex flex-wrap gap-2 mb-4">${sourceBadges}</div>
          <div class="space-y-3 max-h-[600px] overflow-y-auto scrollbar-thin">
            ${latest.map((item) => `
              <div class="bg-slate-800 rounded-lg p-4 hover:bg-slate-700 transition-colors">
                <div class="flex items-center gap-3 flex-wrap mb-2">
                  <span class="text-xl">${escapeHtml(item.country || 'ğŸŒ')}</span>
                  <span class="font-bold text-slate-300 text-sm">${escapeHtml(item.feedTitle || item.source || 'Source')}</span>
                  <span class="text-slate-500 text-xs">${escapeHtml(formatTime(item.publishedAt))}</span>
                </div>
                <h4 class="text-white text-sm font-medium mb-1">${escapeHtml(item.title || '')}</h4>
                ${item.summary ? `<p class="text-slate-400 text-xs">${escapeHtml(item.summary.substring(0, 140))}...</p>` : ''}
                ${item.link ? `<a href="${escapeHtml(item.link)}" target="_blank" rel="noopener noreferrer" class="text-red-400 hover:text-red-300 text-xs mt-1 inline-block">Lire â†’</a>` : ''}
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    function populateBrief() {
      const container = document.getElementById('hot-topics-container');
      if (!container) return;
      const top5 = newsData.slice(0, 5);
      container.innerHTML = `
        <div class="bg-slate-900 rounded-lg p-6 border border-slate-800">
          <h3 class="text-xl font-bold mb-4">ğŸ”¥ 5 Sujets Chauds (auto)</h3>
          <div class="space-y-4">
            ${top5.map((item, i) => `
              <div class="border-l-4 ${i === 0 ? 'border-red-500' : i < 2 ? 'border-orange-500' : 'border-emerald-500'} pl-4">
                <div class="flex items-center gap-2 mb-1 flex-wrap">
                  <h4 class="font-bold text-white">${i + 1}. ${escapeHtml(item.title || '')}</h4>
                  <span class="px-2 py-0.5 text-xs rounded ${i === 0 ? 'bg-red-500/20 text-red-400' : i < 2 ? 'bg-orange-500/20 text-orange-400' : 'bg-emerald-500/20 text-emerald-400'}">
                    ${i === 0 ? 'ğŸ”´ CRITIQUE' : i < 2 ? 'ğŸŸ  SURVEILLER' : 'ğŸŸ¢ INFO'}
                  </span>
                </div>
                <p class="text-slate-400 text-sm mb-1">${item.summary ? `${escapeHtml(item.summary.substring(0, 150))}...` : 'Actualite du secteur energie'}</p>
                <p class="text-slate-500 text-xs">Source: ${escapeHtml(item.feedTitle || item.source || 'Source')} â€¢ ${escapeHtml(formatTime(item.publishedAt))}</p>
              </div>
            `).join('')}
          </div>
        </div>
      `;
    }

    async function loadData() {
      if (isLoading) return;
      isLoading = true;
      try {
        let newsPayload;
        let stockPayload;
        if (STANDALONE_MODE) {
          [newsPayload, stockPayload] = await Promise.all([loadStandaloneNews(), loadStandaloneStock()]);
        } else {
          const [newsRes, stockRes] = await Promise.all([
            fetch('/api/news', { cache: 'no-store' }),
            fetch('/api/stock', { cache: 'no-store' }),
          ]);
          if (!newsRes.ok) throw new Error(`News API ${newsRes.status}`);
          if (!stockRes.ok) throw new Error(`Stock API ${stockRes.status}`);
          newsPayload = await newsRes.json();
          stockPayload = await stockRes.json();
        }

        newsData = Array.isArray(newsPayload.items) ? newsPayload.items : [];
        sourcesUsed = Array.isArray(newsPayload.sources) ? newsPayload.sources : [];
        stockData = stockPayload || null;

        updateStockWidget();
        populateMentions(newsPayload.updatedAt || new Date().toISOString());
        populateBrief();
      } catch (error) {
        console.error('Load error:', error);
      } finally {
        isLoading = false;
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const firstNav = document.querySelector('.nav-btn');
      if (firstNav) firstNav.classList.add('bg-red-600', 'text-white');
      const modeBadge = document.getElementById('mode-badge');
      if (modeBadge) {
        modeBadge.textContent = STANDALONE_MODE ? 'MODE LOCAL (SANS NODE) - SNAPSHOT AUTO SI BLOQUE' : 'MODE API NETLIFY';
        modeBadge.classList.remove('hidden');
      }
      loadData();
      setInterval(loadData, REFRESH_MS);
    });
  </script>

</body>
</html>
